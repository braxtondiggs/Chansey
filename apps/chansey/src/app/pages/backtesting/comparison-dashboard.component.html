<p-card header="Comparison Builder" class="comparison-card">
  <form [formGroup]="form" class="form-grid" (ngSubmit)="createComparison()">
    <p-floatLabel>
      <input pInputText formControlName="name" placeholder="Comparison name" />
      <label for="name">Comparison Name</label>
    </p-floatLabel>
    <button
      pButton
      type="submit"
      label="Generate Report"
      [disabled]="disableCompare()"
      [loading]="createReportMutation.isPending()"
    ></button>
  </form>
  <p-message *ngIf="selectedRunIds().size < 2" severity="info" text="Select at least two completed runs." />
</p-card>

<p-card header="Completed Runs">
  <p-table [value]="completedRuns()" dataKey="id">
    <ng-template pTemplate="header">
      <tr>
        <th>Select</th>
        <th>Name</th>
        <th>Algorithm</th>
        <th>Return</th>
        <th>Sharpe</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-run>
      <tr>
        <td>
          <p-checkbox
            [binary]="true"
            [ngModel]="selectedRunIds().has(run.id)"
            (onChange)="toggleRunSelection(run, $event.checked)"
          ></p-checkbox>
        </td>
        <td>{{ run.name }}</td>
        <td>{{ run.algorithm?.name || 'â€”' }}</td>
        <td>{{ run.totalReturn | percent: '1.0-2' }}</td>
        <td>{{ run.sharpeRatio || 0 | number: '1.2-2' }}</td>
      </tr>
    </ng-template>
  </p-table>
</p-card>

<p-card *ngIf="comparisonResult()" header="Comparison Summary" class="result-card">
  <div class="summary-grid">
    <div>
      <span class="label">Best Return</span>
      <strong>{{ comparisonResult()?.summary?.bestReturn | percent: '1.0-2' }}</strong>
    </div>
    <div>
      <span class="label">Best Sharpe</span>
      <strong>{{ comparisonResult()?.summary?.bestSharpe | number: '1.2-2' }}</strong>
    </div>
    <div>
      <span class="label">Lowest Drawdown</span>
      <strong>{{ comparisonResult()?.summary?.lowestDrawdown | percent: '1.0-2' }}</strong>
    </div>
  </div>

  <p-table [value]="comparisonResult()?.runs">
    <ng-template pTemplate="header">
      <tr>
        <th>Run</th>
        <th>Algorithm</th>
        <th>Return</th>
        <th>Sharpe</th>
        <th>Drawdown</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item>
      <tr>
        <td>{{ item.run.name }}</td>
        <td>{{ item.run.algorithm?.name }}</td>
        <td>{{ item.metrics?.totalReturn | percent: '1.0-2' }}</td>
        <td>{{ item.metrics?.sharpeRatio | number: '1.2-2' }}</td>
        <td>{{ item.metrics?.maxDrawdown | percent: '1.0-2' }}</td>
      </tr>
    </ng-template>
  </p-table>
</p-card>
