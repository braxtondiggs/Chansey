{
  "endpoint": "POST /api/orders",
  "description": "Place a manual order on a cryptocurrency exchange",
  "authentication": "Required (JWT Bearer token)",
  "rateLimit": "100 requests/minute per user",
  "request": {
    "headers": {
      "Authorization": "Bearer <jwt_token>",
      "Content-Type": "application/json"
    },
    "body": {
      "exchangeKeyId": "uuid",
      "symbol": "string (e.g., 'BTC/USDT')",
      "orderType": "enum: market | limit | stop_loss | stop_limit | trailing_stop | take_profit | oco",
      "side": "enum: buy | sell",
      "quantity": "number (positive)",
      "price": "number (required for limit, stop_limit)",
      "stopPrice": "number (required for stop_loss, stop_limit)",
      "trailingAmount": "number (required for trailing_stop)",
      "trailingType": "enum: amount | percentage (required for trailing_stop)",
      "takeProfitPrice": "number (required for take_profit, oco)",
      "stopLossPrice": "number (required for oco)"
    },
    "examples": {
      "market_buy": {
        "exchangeKeyId": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
        "symbol": "BTC/USDT",
        "orderType": "market",
        "side": "buy",
        "quantity": 0.01
      },
      "limit_sell": {
        "exchangeKeyId": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
        "symbol": "ETH/USD",
        "orderType": "limit",
        "side": "sell",
        "quantity": 0.5,
        "price": 2500.00
      },
      "stop_loss_sell": {
        "exchangeKeyId": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
        "symbol": "BTC/USDT",
        "orderType": "stop_loss",
        "side": "sell",
        "quantity": 0.01,
        "stopPrice": 45000.00
      },
      "trailing_stop_sell": {
        "exchangeKeyId": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
        "symbol": "BTC/USDT",
        "orderType": "trailing_stop",
        "side": "sell",
        "quantity": 0.01,
        "trailingAmount": 1000,
        "trailingType": "amount"
      },
      "oco_sell": {
        "exchangeKeyId": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
        "symbol": "BTC/USDT",
        "orderType": "oco",
        "side": "sell",
        "quantity": 0.01,
        "takeProfitPrice": 55000.00,
        "stopLossPrice": 45000.00
      }
    }
  },
  "response": {
    "success": {
      "status": 201,
      "body": {
        "id": "uuid",
        "exchangeKeyId": "uuid",
        "symbol": "string",
        "orderType": "string",
        "side": "string",
        "quantity": "number",
        "price": "number | null",
        "status": "string (new | open)",
        "isManual": "boolean (true)",
        "exchangeOrderId": "string | null",
        "filledQuantity": "number (0)",
        "fee": "number | null",
        "stopPrice": "number | null",
        "trailingAmount": "number | null",
        "trailingType": "string | null",
        "takeProfitPrice": "number | null",
        "stopLossPrice": "number | null",
        "ocoLinkedOrderId": "string | null",
        "createdAt": "ISO 8601 timestamp",
        "updatedAt": "ISO 8601 timestamp"
      },
      "example": {
        "id": "a1b2c3d4-e5f6-4321-a987-123456789abc",
        "exchangeKeyId": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
        "symbol": "BTC/USDT",
        "orderType": "limit",
        "side": "buy",
        "quantity": 0.01,
        "price": 50000.00,
        "status": "open",
        "isManual": true,
        "exchangeOrderId": "12345678",
        "filledQuantity": 0,
        "fee": null,
        "stopPrice": null,
        "trailingAmount": null,
        "trailingType": null,
        "takeProfitPrice": null,
        "stopLossPrice": null,
        "ocoLinkedOrderId": null,
        "createdAt": "2025-10-08T12:00:00.000Z",
        "updatedAt": "2025-10-08T12:00:00.000Z"
      }
    },
    "errors": {
      "400_validation": {
        "status": 400,
        "body": {
          "statusCode": 400,
          "message": ["quantity must be a positive number"],
          "error": "Bad Request"
        }
      },
      "402_insufficient_balance": {
        "status": 402,
        "body": {
          "statusCode": 402,
          "message": "Insufficient balance. You have 1000 USDT but need 1050 USDT including fees",
          "error": "Payment Required"
        }
      },
      "404_exchange_key_not_found": {
        "status": 404,
        "body": {
          "statusCode": 404,
          "message": "Exchange key not found or does not belong to user",
          "error": "Not Found"
        }
      },
      "422_invalid_trading_pair": {
        "status": 422,
        "body": {
          "statusCode": 422,
          "message": "Trading pair BTC/XYZ is not supported on this exchange",
          "error": "Unprocessable Entity"
        }
      },
      "503_exchange_unavailable": {
        "status": 503,
        "body": {
          "statusCode": 503,
          "message": "Exchange API is currently unavailable. Please try again later.",
          "error": "Service Unavailable"
        }
      }
    }
  },
  "validation": {
    "exchangeKeyId": "Must be a valid UUID belonging to the authenticated user",
    "symbol": "Must be a valid trading pair supported by the selected exchange",
    "orderType": "Must be one of: market, limit, stop_loss, stop_limit, trailing_stop, take_profit, oco",
    "side": "Must be either 'buy' or 'sell'",
    "quantity": "Must be positive and within exchange min/max limits",
    "price": "Required for limit and stop_limit orders; must match exchange price precision",
    "stopPrice": "Required for stop_loss and stop_limit orders; must be valid relative to market price",
    "trailingAmount": "Required for trailing_stop orders; must be positive",
    "trailingType": "Required for trailing_stop orders; must be 'amount' or 'percentage'",
    "takeProfitPrice": "Required for take_profit and oco orders; must be on correct side of market",
    "stopLossPrice": "Required for oco orders; must be on opposite side of takeProfitPrice"
  },
  "performance": {
    "target": "< 3 seconds p95",
    "steps": [
      "Validate DTO (< 100ms)",
      "Fetch exchange market data (< 500ms, cached)",
      "Validate balance (< 500ms)",
      "Submit to exchange via CCXT (< 1500ms)",
      "Persist to database (< 200ms)"
    ]
  },
  "businessRules": {
    "FR-001": "Allow users to place manual orders on connected exchanges",
    "FR-002": "Support all major order types",
    "FR-003": "Validate sufficient balance including fees",
    "FR-005": "Submit validated orders to exchange API",
    "FR-007": "Prevent duplicate submissions",
    "FR-018": "Assign unique identifier",
    "NFR-002": "Order submission must initiate within 3 seconds"
  }
}
